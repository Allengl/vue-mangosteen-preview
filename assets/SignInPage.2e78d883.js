import{u as S,B as x,I as B,b as I,F as c,a as k,M as w,v as F,c as N,h as p}from"./index.3384a87d.js";import{by as g,bF as j,bx as m,bE as e,bU as f,bV as D}from"./vendor.c0b9b4fd.js";import"./vant.875bb03a.js";const M=i=>{const t=g(i);return{ref:t,toggle:()=>t.value=!t.value,on:()=>t.value=!0,off:()=>t.value=!1}},T="_logo_ly99d_1",E="_icon_ly99d_8",O="_appName_ly99d_12",r={logo:T,icon:E,appName:O},P=j({setup:(i,t)=>{const b=S(),o=m({email:"",code:""}),s=m({email:[],code:[]}),u=g(),{ref:y,toggle:U,on:v,off:h}=M(!1),_=D(),V=async a=>{if(a.preventDefault(),Object.assign(s,{email:[],code:[]}),Object.assign(s,F(o,[{key:"email",type:"required",message:"\u5FC5\u586B"},{key:"email",type:"pattern",regex:/.+@.+/,message:"\u5FC5\u987B\u662F\u90AE\u7BB1\u5730\u5740"},{key:"code",type:"required",message:"\u5FC5\u586B"}])),!N(s)){const n=await p.post("/session",o).catch(d);localStorage.setItem("jwt",n.data.jwt);const l=localStorage.getItem("returnTo");b.refreshMe(),_.push(l||"/")}},d=a=>{throw a.response.status===422&&Object.assign(s,a.response.data.errors),a},C=async()=>{v(),await p.post("/validation_codes",{email:o.email},{_autoLoading:!0}).catch(d).finally(h),u.value.startCount()};return()=>e(w,null,{title:()=>"\u767B\u5F55",icon:()=>e(x,null,null),default:()=>e("div",{class:r.wrapper},[e("div",{class:r.logo},[e(B,{class:r.icon,name:"mangosteen"},null),e("h1",{class:r.appName},[f("\u5C71\u7AF9\u8BB0\u8D26")])]),e(I,{onSubmit:V},{default:()=>{var a,n;return[e(c,{label:"\u90AE\u7BB1\u5730\u5740",type:"text",placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1\uFF0C\u7136\u540E\u70B9\u51FB\u53D1\u9001\u9A8C\u8BC1\u7801",modelValue:o.email,"onUpdate:modelValue":l=>o.email=l,error:(a=s.email)==null?void 0:a[0]},null),e(c,{ref:u,label:"\u9A8C\u8BC1\u7801",type:"validationCode",placeholder:"\u8BF7\u8F93\u5165\u516D\u4F4D\u6570\u5B57",disabled:y.value,onClick:C,modelValue:o.code,"onUpdate:modelValue":l=>o.code=l,error:(n=s.code)==null?void 0:n[0]},null),e(c,{style:{paddingTop:"96px"}},{default:()=>[e(k,{type:"submit"},{default:()=>[f("\u767B\u5F55")]})]})]}})])})}});export{P as SignInPage,P as default};
