import{d as I,T as w,g as D,F as j,h,e as A}from"./index.3384a87d.js";import{bF as d,bE as r,bU as m,by as p,bt as c,bs as u,bA as b}from"./vendor.c0b9b4fd.js";import{i as $}from"./echarts.4685a5c1.js";import"./vant.875bb03a.js";const M="_wrapper_3j8qr_1",L="_topItem_3j8qr_5",k="_sign_3j8qr_11",Y="_bar_wrapper_3j8qr_22",C="_bar_text_3j8qr_27",F="_bar_3j8qr_22",E="_bar_inner_3j8qr_41",o={wrapper:M,topItem:L,sign:k,bar_wrapper:Y,bar_text:C,bar:F,bar_inner:E},V=d({props:{data:{type:Array}},setup:(e,s)=>()=>r("div",{class:o.wrapper},[e.data&&e.data.length>0?e.data.map(({tag:a,amount:t,percent:l})=>r("div",{class:o.topItem},[r("div",{class:o.sign},[a.sign]),r("div",{class:o.bar_wrapper},[r("div",{class:o.bar_text},[r("span",null,[a.name,m(" - "),l,m("%")]),r("span",null,[" ",m("\uFFE5"),r(I,{value:t},null)," "])]),r("div",{class:o.bar},[r("div",{class:o.bar_inner,style:{width:`${l}%`}},null)])])])):r("div",{class:o.noData},[m("\u6682\u65E0\u6570\u636E")])])}),B="_wrapper_ymbwx_1",N="_demo_ymbwx_5",P="_demo2_ymbwx_9",U="_demo3_ymbwx_13",G="_topItem_ymbwx_17",W="_sign_ymbwx_23",X="_bar_wrapper_ymbwx_34",z="_bar_text_ymbwx_39",H="_bar_ymbwx_34",J="_bar_inner_ymbwx_53",K={wrapper:B,demo:N,demo2:P,demo3:U,topItem:G,sign:W,bar_wrapper:X,bar_text:z,bar:H,bar_inner:J},Q="_wrapper_wxcjg_1",R={wrapper:Q},Z={tooltip:{show:!0,trigger:"axis",formatter:([e])=>{const[s,a]=e.data;return`${new w(new Date(s)).format("YYYY\u5E74MM\u6708DD\u65E5")} \uFFE5${D(a)}`}},grid:[{left:16,top:20,right:16,bottom:20}],xAxis:{type:"time",boundaryGap:["3%","0%"],axisLabel:{formatter:e=>new w(new Date(e)).format("MM-DD")},axisTick:{alignWithLabel:!0}},yAxis:{show:!0,type:"value",splitLine:{show:!0,lineStyle:{type:"dashed"}},axisLabel:{show:!1}}},ee=d({props:{data:{type:Array,required:!0}},setup:(e,s)=>{const a=p();let t;return c(()=>{a.value!==void 0&&(t=$(a.value),t.setOption({...Z,series:[{data:e.data,type:"line"}]}))}),u(()=>e.data,()=>{t==null||t.setOption({series:[{data:e.data}]})}),()=>r("div",{ref:a,class:R.wrapper},null)}}),te="_wrapper_1cm6i_1",ae={wrapper:te},re={tooltip:{trigger:"item",formatter:e=>{const{name:s,value:a,percent:t}=e;return`${s}: \uFFE5${D(a)} \u5360\u6BD4 ${t}%`}},grid:[{left:0,top:0,right:0,bottom:0}],series:[{type:"pie",radius:"70%",emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},ne=d({props:{data:{type:Array}},setup:(e,s)=>{const a=p();let t;return c(()=>{a.value!==void 0&&(t=$(a.value),t.setOption(re))}),u(()=>e.data,()=>{t==null||t.setOption({series:[{data:e.data}]})}),u(()=>e.data,()=>{t==null||t.setOption({series:[{data:e.data}]})}),()=>r("div",{ref:a,class:ae.wrapper},null)}}),se=24*3600*1e3,oe=d({props:{startDate:{type:String,required:!1},endDate:{type:String,required:!1}},setup:(e,s)=>{const a=p("expenses"),t=p([]),l=b(()=>{if(!e.startDate||!e.endDate)return[];const i=(new Date(e.endDate).getTime()-new Date(e.startDate).getTime())/se+1;return Array.from({length:i}).map((g,O)=>{const v=new w(e.startDate+"T00:00:00.000+0800").add(O,"day").getTimestamp(),x=t.value[0],S=x&&new Date(x.happen_at+"T00:00:00.000+0800").getTime()===v?t.value.shift().amount:0;return[new Date(v).toISOString(),S]})}),y=async()=>{const n=await h.get("/items/summary",{happen_after:e.startDate,happen_before:e.endDate,kind:a.value,group_by:"happen_at"},{_mock:"itemSummary",_autoLoading:!0});t.value=n.data.groups};c(y),u(()=>a.value,y);const _=p([]),T=b(()=>_.value.map(n=>({name:n.tag.name,value:n.amount}))),q=b(()=>{const n=_.value.reduce((i,g)=>i+g.amount,0);return _.value.map(i=>({...i,percent:Math.round(i.amount/n*100)}))}),f=async()=>{const n=await h.get("/items/summary",{happen_after:e.startDate,happen_before:e.endDate,kind:a.value,group_by:"tag_id"},{_mock:"itemSummary"});_.value=n.data.groups};return c(f),u(()=>a.value,f),()=>r("div",{class:K.wrapper},[r(j,{label:"\u7C7B\u578B",type:"select",options:[{value:"expenses",text:"\u652F\u51FA"},{value:"income",text:"\u6536\u5165"}],modelValue:a.value,"onUpdate:modelValue":n=>a.value=n},null),r(ee,{data:l.value},null),r(ne,{data:T.value},null),r(V,{data:q.value},null)])}}),le=d({setup:(e,s)=>()=>r(A,{component:oe,rerenderOnSwitchTab:!0,hideThisYear:!0},null)});export{le as StatisticsPage,le as default};
